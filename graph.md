- [Работа с графом](#Работа-с-графом)
  - [Шаг `init`. Инициализация](#2.1-Шаг-init-Инициализация)
  - [Шаг `render`. Рендеринг](#2.2-Шаг-render-Рендеринг)
  - [Шаг `start`. Начало](#2.3-Шаг-start-Начало)
  - [Шаг `continue`. Продолжение](#2.4-Шаг-continue-Продолжение)
  - [Шаг `deinit`. Окончание](#2.5-Шаг-deinit-Окончание)

# Работа с графом
Вот так выглядит сгенерированный файл `17676.graph`. У номер скрипта может быть любым. В данном случае это `17676`. Самая первая строчка `script_17676-->` очень важна и не стоит ее удалять.

>Функции графа именуются `"шагами"` графа.

```
script_17676-->
init-->
render-->
start-->
continue-->
deinit-->
the_end();
```
---
## 2.1 Шаг `init`. Инициализация
Все инстансы и `jQuery-элементы` создаются в шаге `init`.

Отделяем инстансы компонентов от `jQuery`-элементов. Записываем все инстансы компонентов в переменную `this.com`, а `jQuery`-элементы в `this.dom`. Так нам всегда будет видно в коде, к какой именно сущности мы обращаемся.

Можно разделять инициализацию на несколько шагов, если это вам нужно, но все их названия должны начинаться с `init...` и находиться до шага `render`.

Иногда для некоторых компонетов и методов (`this.tutor.speaker()`, `$$.Dragger()`) требуется наличие в DOM-е передаваемых им элементов в отрендеренном состоянии, для рассчета их позиций (что не очень хорошо), поэтому создание этих элементов может происходить в других шагах после шага `render` или в самом шаге `render`.

> Переменная `this.salt` хранит в себе генерации из файла `card.json`
```javascript
// init
$$.Script.prototype.init = function(cb) {
  // Генерации
  this.props = { ...this.salt };
  // Components
  this.com = {
    button: new $$.Button({
      content: this.tutor.t('done')
    })
  };
  // DOM
  this.dom = {
    button: this.com.button.view,
    buttonContainer: $.div('button-container'),
    scene: $.div('scene'),
    title: $.div('title')
      .html(this.tutor.t('title'))
  };
  cb();
};

```
---
## 2.2 Шаг `render`. Рендеринг
Групповой рендер элементов в `DOM`. Так как `DOM` в браузере достаточно медленная структура, то лучше пореже обращаться к ней. Хоть для нас и не очень важна пока что производительность, но лучше привыкать к этому сразу.

Почти весь рендер (большая часть) должен происходить в шаге `render`. Можно разделять рендер на несколько шагов, если это вам нужно, но все их названия должны начинаться с `render...`. Например, если нужна инициализация каких то компонентов, требующих уже отрендеренных компонентов.

Плюс, если мы будем рендерить все первые элементы все разом в шаге `render`, то унас будет перед глазами наглядная структура того, что у нас есть в `DOM`-е на данный момент.

```javascript
// render
$$.Script.prototype.render = function(cb) {
  // Scene
  this.place.append(
    this.dom.scene.append(
      this.dom.title,
      this.dom.buttonContainer.append(
        this.dom.button
      )
    )
  );
  cb();
};
```
---
## 2.3 Шаг `start`. Начало
Здесь мы только отображаем нашу кнопку play_button и слушаем нажатие.

```javascript
// start
$$.Script.prototype.start = function(cb) {
  this.tutor.play_button(cb);
};
```
---
## 2.4 Шаг `continue`. Продолжение
Этот шаг вспомогательный. Сюда мы возвращаемся каждый раз, если у нас есть какие-то циклические повторения (экраны, fork-и, проверки). Здесь же мы сбрасываем состояние нашего скрипта, если нужно (`this.state.action`, `this.state.error`).

```javascript
// continue
$$.Script.prototype.continue = function(cb) {
  this.state.action = null;
  this.state.error = false;
  cb();
};
```

## 2.5 Шаг `deinit`. Окончание
Здесь мы очищаем нашу сцену, и снимаем обработчики событий с других элементов, если нужно.

```javascript
// deinit
$$.Script.prototype.deinit = function(cb) {
  $$.scene__clear(this.dom.scene);
  cb();
};
```